<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Publications — Angelika Manhart</title>
  <link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
  <style>
    :root {
      --ink:      #0a1f44;
      --mid:      #2a4a6b;
      --muted:    #5b95b8;
      --accent:   #0d3b7a;
      --accent2:  #1a6fa8;
      --pale:     #ddeaf3;
      --white:    #ffffff;
      --bg:       #f0f6fa;
      --border:   #c8dde8;
      --serif:    'DM Serif Display', Georgia, serif;
      --sans:     'DM Sans', system-ui, sans-serif;
    }
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: var(--sans); background: var(--white); color: var(--ink); font-size: 17px; line-height: 1.72; }

    /* NAV */
    nav {
      position: sticky; top: 0; z-index: 100;
      background: rgba(224,237,247,0.92); backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 5vw; height: 62px;
    }
    .nav-name { font-family: var(--serif); font-size: 1.05rem; color: var(--ink); text-decoration: none; display: flex; align-items: center; gap: 0.5rem; }
    .nav-portrait { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; object-position: center 20%; border: 2px solid var(--border); }
    .nav-links { display: flex; gap: 2rem; list-style: none; }
    .nav-links a { font-size: 0.82rem; font-weight: 600; letter-spacing: 0.07em; text-transform: uppercase; color: var(--mid); text-decoration: none; transition: color 0.2s; }
    .nav-links a:hover { color: var(--accent); }
    .hamburger { display: none; }

    /* SECTIONS */
    .section-wrap { padding: 5rem 5vw; max-width: 1140px; margin: 0 auto; }
    .full-bleed { padding: 5rem 5vw; }
    .full-bleed .inner { max-width: 1140px; margin: 0 auto; }
    hr.divider { border: none; border-top: 1px solid var(--border); }
    .section-label { font-size: 0.73rem; font-weight: 700; letter-spacing: 0.18em; text-transform: uppercase; color: var(--accent2); margin-bottom: 0.5rem; }
    .section-title { font-family: var(--serif); font-size: clamp(1.7rem, 2.6vw, 2.3rem); color: var(--ink); margin-bottom: 0.9rem; }
    .section-intro { max-width: 660px; color: var(--mid); font-weight: 300; font-size: 1.05rem; margin-bottom: 2.8rem; line-height: 1.75; }

    footer { text-align: center; padding: 1.8rem 5vw; font-size: 0.78rem; color: var(--muted); border-top: 1px solid var(--border); }

    /* ANIMATIONS */
    @keyframes fadeUp { from { opacity: 0; transform: translateY(22px); } to { opacity: 1; transform: none; } }

    /* RESPONSIVE */
    @media (max-width: 800px) {
      .full-bleed { padding-top: 1rem; padding-bottom: 2rem; }
      .section-label { margin-bottom: 0.2rem; }
      .section-title { margin-bottom: 0.3rem; }
      .section-intro { margin-bottom: 1.2rem; }
      .pub-filters { margin-bottom: 1rem; }
      .pub-item { grid-template-columns: 1fr auto; }
      .pub-thumb { display: none; }
      .pub-year { font-size: 0.72rem; }
      .nav-links {
        display: none;
        flex-direction: column;
        position: absolute;
        top: 62px; left: 0; right: 0;
        background: rgba(224,237,247,0.97);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--border);
        padding: 1rem 5vw;
        gap: 0.5rem;
      }
      .nav-links.open { display: flex; }
      .hamburger {
        display: flex; align-items: center; justify-content: center;
        background: none; border: none; cursor: pointer;
        width: 38px; height: 38px; padding: 0;
      }
      .hamburger svg { width: 22px; height: 22px; stroke: var(--ink); stroke-width: 2; stroke-linecap: round; }
    }

    /* PUBLICATIONS */
    .pub-filters { display: flex; gap: 0.6rem; flex-wrap: wrap; margin-bottom: 2rem; }
    .pub-filter-btn { padding: 0.45rem 1.1rem; border: 2px solid var(--border); border-radius: 100px; background: var(--white); color: var(--mid); font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; }
    .pub-filter-btn:hover { border-color: var(--accent2); color: var(--accent2); }
    .pub-filter-btn.active { background: var(--accent); border-color: var(--accent); color: #fff; }
    .pub-list { display: flex; flex-direction: column; gap: 1.1rem; }
    .pub-item { background: var(--white); border: 1px solid var(--border); border-left: 3px solid var(--accent2); padding: 1.4rem 1.6rem; border-radius: 0 8px 8px 0; display: grid; grid-template-columns: 64px 1fr auto; gap: 0.5rem 1.2rem; align-items: start; }
    .pub-item.hidden { display: none; }
    .pub-thumb { width: 64px; height: 64px; border-radius: 6px; background: var(--pale); border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; overflow: hidden; flex-shrink: 0; }
    .pub-thumb img { width: 100%; height: 100%; object-fit: cover; }
    .pub-thumb svg { width: 28px; height: 28px; opacity: 0.35; }
    .pub-title-row { display: flex; align-items: baseline; gap: 0.6rem; flex-wrap: wrap; margin-bottom: 0.25rem; }
    .pub-title { font-family: var(--serif); font-size: 1rem; color: var(--ink); }
    .pub-tag { display: inline-block; font-size: 0.65rem; font-weight: 700; letter-spacing: 0.06em; text-transform: uppercase; padding: 0.15rem 0.55rem; border-radius: 4px; color: #fff; white-space: nowrap; vertical-align: middle; position: relative; top: -1px; }
    .pub-tag-data { background: #2e7d32; }
    .pub-tag-theorem { background: #c62828; }
    .pub-tag-other { background: #795548; }
    .pub-tag-collective { background: #1a6fa8; }
    .pub-tag-organelles { background: #7e6b9e; }
    .pub-tag-cytoskeleton { background: #0891b2; }
    .pub-tag-bacteria { background: #d97706; }
    .pub-tag-theme-other { background: #64748b; }
    .pub-meta { font-size: 0.84rem; color: var(--muted); font-weight: 300; }
    .pub-meta strong { color: var(--mid); font-weight: 600; }
    .pub-year { font-size: 0.78rem; font-weight: 700; color: var(--accent2); letter-spacing: 0.06em; white-space: nowrap; padding-top: 0.2rem; }
    .pub-links { display: flex; gap: 0.5rem; margin-top: 0.65rem; flex-wrap: wrap; }
    .pub-link { font-size: 0.73rem; font-weight: 600; letter-spacing: 0.06em; text-transform: uppercase; padding: 0.2rem 0.6rem; border: 1px solid var(--border); border-radius: 4px; color: var(--mid); text-decoration: none; transition: all 0.2s; }
    .pub-link:hover { border-color: var(--accent2); color: var(--accent2); }

    /* COAUTHORSHIP NETWORK */
    .pub-network-toggle { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.55rem 1.3rem; border: 2px solid var(--border); border-radius: 8px; background: var(--white); color: var(--mid); font-family: var(--sans); font-size: 0.85rem; font-weight: 600; cursor: pointer; transition: all 0.2s; margin-bottom: 1.5rem; }
    .pub-network-toggle .toggle-thumb { width: 28px; height: 28px; border-radius: 4px; border: 1px solid var(--border); overflow: hidden; flex-shrink: 0; background: var(--pale); }
    .pub-network-toggle .toggle-thumb svg { width: 100%; height: 100%; }
    .pub-network-toggle:hover { border-color: var(--accent2); color: var(--accent2); }
    .pub-network-toggle .toggle-arrow { transition: transform 0.3s; font-size: 0.7rem; }
    .pub-network-toggle.open .toggle-arrow { transform: rotate(180deg); }
    .pub-network-wrap { max-height: 0; overflow: hidden; transition: max-height 0.5s ease, opacity 0.4s ease; opacity: 0; margin-bottom: 0; }
    .pub-network-wrap.open { max-height: 850px; opacity: 1; margin-bottom: 2rem; }
    .pub-network-inner { background: var(--white); border: 1px solid var(--border); border-radius: 10px; overflow: hidden; }
    .pub-network-legend { display: flex; gap: 1.2rem; align-items: center; padding: 0.5rem 1.2rem; border-bottom: 1px solid var(--border); font-size: 0.75rem; color: var(--mid); flex-wrap: wrap; }
    .pub-network-legend .legend-item { display: flex; align-items: center; gap: 0.35rem; }
    .pub-network-legend .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .pub-network-legend .legend-sq { width: 10px; height: 10px; border-radius: 2px; }
    #network-graph { width: 100%; height: 700px; display: block; }
    #network-tooltip { position: fixed; background: var(--ink); color: white; padding: 0.5rem 0.8rem; border-radius: 6px; font-size: 0.78rem; pointer-events: none; opacity: 0; transition: opacity 0.15s; max-width: 260px; line-height: 1.5; z-index: 200; }
    #network-tooltip .tt-name { font-weight: 700; font-size: 0.85rem; margin-bottom: 0.15rem; }
    #network-tooltip .tt-count { opacity: 0.7; }
    .net-node circle { cursor: pointer; stroke-width: 2; transition: r 0.2s; }
    .net-node text { pointer-events: none; font-size: 10px; fill: var(--ink); font-weight: 500; }
    .net-link { stroke: #c8dde8; stroke-opacity: 0.5; }
    .net-link.highlighted { stroke: var(--accent); stroke-opacity: 0.9; stroke-width: 2.5 !important; }
    .net-node.dimmed circle, .net-node.dimmed rect { opacity: 0.15; }
    .net-node.dimmed text { opacity: 0.1; }
    .net-link.dimmed { stroke-opacity: 0.05; }
    .net-node.selected circle { stroke: #e05c2a; stroke-width: 3; }
    .net-node.selected rect { stroke: #e05c2a; stroke-width: 3; }
    .pub-network-status { display: none; align-items: center; gap: 0.6rem; margin-bottom: 1rem; padding: 0.5rem 1rem; background: var(--pale); border: 1px solid var(--border); border-radius: 6px; font-size: 0.85rem; color: var(--mid); }
    .pub-network-status.active { display: inline-flex; }
    .pub-network-status .clear-btn { background: none; border: none; color: var(--accent2); font-weight: 600; cursor: pointer; font-size: 0.85rem; text-decoration: underline; }
  </style>
</head>
<body>

  <!-- NAV -->
  <nav>
    <a class="nav-name" href="index.html"><img class="nav-portrait" src="images/portrait_me.jpg" alt=""/>Angelika Manhart</a>
    <ul class="nav-links">
      <li><a href="index.html#about">About</a></li>
      <li><a href="research.html">Research</a></li>
      <li><a href="publications.html">Publications</a></li>
      <li><a href="index.html#team">Team</a></li>
      <li style="display:none;"><a href="teaching.html">Teaching</a></li>
      <li><a href="outreach.html">Outreach & Art</a></li>
      <li><a href="cv.html">CV</a></li>
      <li><a href="index.html#contact">Contact</a></li>
    </ul>
    <button class="hamburger" aria-label="Menu" onclick="document.querySelector('.nav-links').classList.toggle('open')">
      <svg viewBox="0 0 24 24" fill="none"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
    </button>
  </nav>
  <script>document.querySelector('.nav-links').addEventListener('click',function(e){if(e.target.tagName==='A')this.classList.remove('open');})</script>

  <!-- PUBLICATIONS -->
  <div id="publications" class="full-bleed" style="background: var(--bg);">
    <div class="inner">
      <div class="">
        <p class="section-label">Scientific Articles</p>
        <h2 class="section-title">Publications</h2>
        <p class="section-intro">Peer-reviewed articles and book chapters.</p>
      </div>
      <!-- Network toggle + collapsible panel -->
      <div style="display: flex; gap: 0.8rem; flex-wrap: wrap; align-items: stretch; margin-bottom: 1.5rem;">
      <a href="research.html" class="pub-network-toggle" style="text-decoration: none; margin-bottom: 0;">
        <div class="toggle-thumb"><svg viewBox="0 0 28 28"><circle cx="8" cy="14" r="6" fill="none" stroke="#2563eb" stroke-width="1.5"/><circle cx="20" cy="8" r="4" fill="none" stroke="#059669" stroke-width="1.5"/><circle cx="22" cy="20" r="5" fill="none" stroke="#d97706" stroke-width="1.5"/><rect x="13" y="12" width="3" height="3" rx="0.5" fill="#fca5a5" stroke="#c62828" stroke-width="0.6"/><rect x="11" y="18" width="3" height="3" rx="0.5" fill="#a7f3d0" stroke="#059669" stroke-width="0.6"/><rect x="18" y="14" width="3" height="3" rx="0.5" fill="#e5e7eb" stroke="#6b7280" stroke-width="0.6"/><line x1="8" y1="14" x2="13" y2="13" stroke="#c8dde8" stroke-width="0.8"/><line x1="20" y1="8" x2="18" y2="14" stroke="#c8dde8" stroke-width="0.8"/><line x1="22" y1="20" x2="14" y2="19" stroke="#c8dde8" stroke-width="0.8"/></svg></div>
        <span>View Research Themes &rarr;</span>
      </a>
      <button class="pub-network-toggle" id="networkToggle" style="margin-bottom: 0;">
        <div class="toggle-thumb"><svg viewBox="0 0 28 28"><circle cx="14" cy="14" r="4" fill="#e05c2a" stroke="#c04010" stroke-width="1"/><circle cx="6" cy="8" r="2.5" fill="#c0392b" stroke="#fff" stroke-width="0.5"/><circle cx="22" cy="8" r="2.5" fill="#059669" stroke="#fff" stroke-width="0.5"/><circle cx="8" cy="22" r="2" fill="#059669" stroke="#fff" stroke-width="0.5"/><circle cx="20" cy="20" r="2" fill="#c0392b" stroke="#fff" stroke-width="0.5"/><line x1="14" y1="14" x2="6" y2="8" stroke="#c8dde8" stroke-width="0.8"/><line x1="14" y1="14" x2="22" y2="8" stroke="#c8dde8" stroke-width="0.8"/><line x1="14" y1="14" x2="8" y2="22" stroke="#c8dde8" stroke-width="0.8"/><line x1="14" y1="14" x2="20" y2="20" stroke="#c8dde8" stroke-width="0.8"/><rect x="9" y="10" width="4" height="4" rx="0.8" fill="#fca5a5" stroke="#c0392b" stroke-width="0.6"/><rect x="17" y="16" width="4" height="4" rx="0.8" fill="#a7f3d0" stroke="#059669" stroke-width="0.6"/></svg></div>
        <span class="toggle-arrow">&#9660;</span> Show Co-authorship Network
      </button>
      </div>
      <div class="pub-network-wrap" id="networkWrap">
        <div class="pub-network-inner">
          <div class="pub-network-legend">
            <div class="legend-item"><svg width="12" height="12" viewBox="0 0 12 12"><circle cx="6" cy="6" r="5" fill="var(--muted)" stroke="#fff" stroke-width="1"/></svg><span>= Authors</span></div>
            <div class="legend-item"><svg width="12" height="12" viewBox="0 0 12 12"><rect x="1" y="1" width="10" height="10" rx="2" fill="var(--pale)" stroke="var(--muted)" stroke-width="1.5"/></svg><span>= Publications</span></div>
            <div class="legend-item" style="margin-left:auto;"><div class="legend-dot" style="background:#c0392b;"></div><span>Proofs</span></div>
            <div class="legend-item"><div class="legend-dot" style="background:#059669;"></div><span>Data</span></div>
          </div>
          <svg id="network-graph"></svg>
        </div>
      </div>
      <div id="network-tooltip"></div>

      <div class="pub-network-status" id="networkStatus">
        <span id="networkStatusText">Filtering by: —</span>
        <button class="clear-btn" id="networkClear">Clear</button>
      </div>

      <div class="pub-filters">
        <button class="pub-filter-btn active" data-filter="all">All</button>
        <button class="pub-filter-btn" data-filter="data">Data</button>
        <button class="pub-filter-btn" data-filter="theorem">Theorems</button>
        <button class="pub-filter-btn" data-filter="collective">Collectivity</button>
        <button class="pub-filter-btn" data-filter="organelles">Organelles</button>
        <button class="pub-filter-btn" data-filter="cytoskeleton">Cytoskeleton</button>
        <button class="pub-filter-btn" data-filter="bacteria">Bacteria</button>
      </div>

      <div class="pub-list" id="pubList"></div>
    </div>
  </div>



  <script>
    // ── PUBLICATION DATA ──
    var _pubData = [];
    var _authorNameMap = {}; // full name -> display name (last-name based)

    var BOOK_ICON_SVG = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 19.5A2.5 2.5 0 016.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 014 19.5v-15A2.5 2.5 0 016.5 2z"/></svg>';

    var themeTagMap = { collective: 'Collectivity', organelles: 'Organelles', cytoskeleton: 'Cytoskeleton', bacteria: 'Bacteria', other: 'Other' };
    var themeClassMap = { collective: 'pub-tag-collective', organelles: 'pub-tag-organelles', cytoskeleton: 'pub-tag-cytoskeleton', bacteria: 'pub-tag-bacteria', other: 'pub-tag-theme-other' };

    function buildAuthorNameMap(publications) {
      // Build a map from full name ("Lancaster C") to display name ("Lancaster")
      // For disambiguation when multiple authors share a last name, use "I. Last" format
      var lastNameGroups = {};
      publications.forEach(function(p) {
        p.authors.split(', ').forEach(function(a) {
          a = a.trim();
          if (!a) return;
          var parts = a.split(' ');
          var lastName = parts[0];
          if (!lastNameGroups[lastName]) lastNameGroups[lastName] = {};
          lastNameGroups[lastName][a] = true;
        });
      });
      var nameMap = {};
      Object.keys(lastNameGroups).forEach(function(lastName) {
        var fullNames = Object.keys(lastNameGroups[lastName]);
        if (fullNames.length === 1) {
          nameMap[fullNames[0]] = lastName;
        } else {
          fullNames.forEach(function(fullName) {
            var parts = fullName.trim().split(' ');
            var initials = parts.slice(1).join('');
            nameMap[fullName] = initials + '. ' + lastName;
          });
        }
      });
      return nameMap;
    }

    function renderPubItem(p) {
      var tagClass = p.category === 'theorem' ? 'pub-tag-theorem' : (p.category === 'data' ? 'pub-tag-data' : 'pub-tag-other');
      var tagLabel = p.category === 'theorem' ? 'Theorems' : (p.category === 'data' ? 'Data' : 'Other');

      var themeTagsHtml = '';
      if (p.themes) {
        p.themes.forEach(function(t) {
          if (themeTagMap[t]) themeTagsHtml += '<span class="pub-tag ' + themeClassMap[t] + '">' + themeTagMap[t] + '</span>';
        });
      }

      var thumbHtml = p.thumbnail
        ? '<img src="' + p.thumbnail + '" alt="thumbnail"/>'
        : BOOK_ICON_SVG;

      var linksHtml = '';
      if (p.pdfUrl) linksHtml += '<a class="pub-link" href="' + p.pdfUrl + '" target="_blank">PDF</a>';
      if (p.doi) linksHtml += '<a class="pub-link" href="https://doi.org/' + p.doi + '" target="_blank">DOI</a>';

      // Build data-authors (last-name based, comma-separated) for network filter matching
      var authorLastNames = p.authors.split(', ').map(function(a) {
        return _authorNameMap[a.trim()] || a.trim();
      }).join(',');

      return '<div class="pub-item" data-category="' + p.category + '" data-themes="' + (p.themes || []).join(' ') + '" data-authors="' + authorLastNames + '" data-title="' + p.title.replace(/"/g, '&quot;') + '">' +
        '<div class="pub-thumb">' + thumbHtml + '</div>' +
        '<div>' +
          '<div class="pub-title-row"><p class="pub-title">' + p.title + '</p><span class="pub-tag ' + tagClass + '">' + tagLabel + '</span>' + themeTagsHtml + '</div>' +
          '<p class="pub-meta">' + p.authors + ' &middot; <strong>' + p.journal + '</strong></p>' +
          (linksHtml ? '<div class="pub-links">' + linksHtml + '</div>' : '') +
        '</div>' +
        '<span class="pub-year">' + p.year + '</span>' +
      '</div>';
    }

    // ── UNIFIED PUBLICATION FILTER ──
    var activeFilters = [];
    var activeNetworkFilter = null;
    var themeFilters = ['collective', 'organelles', 'cytoskeleton', 'bacteria'];
    var categoryFilters = ['data', 'theorem'];

    function filterPublications() {
      var statusEl = document.getElementById('networkStatus');
      var statusText = document.getElementById('networkStatusText');
      document.querySelectorAll('.pub-item').forEach(function(item) {
        var catMatch = true;
        if (activeFilters.length > 0) {
          catMatch = activeFilters.every(function(f) {
            if (themeFilters.indexOf(f) !== -1) {
              var themes = (item.getAttribute('data-themes') || '').split(' ');
              return themes.indexOf(f) !== -1;
            } else {
              return item.getAttribute('data-category') === f;
            }
          });
        }
        var netMatch = true;
        if (activeNetworkFilter) {
          if (activeNetworkFilter.type === 'author') {
            var authors = (item.getAttribute('data-authors') || '').split(',');
            netMatch = authors.indexOf(activeNetworkFilter.value) !== -1;
          } else {
            var title = item.getAttribute('data-title') || '';
            netMatch = title === activeNetworkFilter.value;
          }
        }
        if (catMatch && netMatch) { item.classList.remove('hidden'); } else { item.classList.add('hidden'); }
      });
      if (activeNetworkFilter) {
        statusEl.classList.add('active');
        var label = activeNetworkFilter.type === 'author' ? activeNetworkFilter.value : ('"' + activeNetworkFilter.value.slice(0, 50) + (activeNetworkFilter.value.length > 50 ? '...' : '') + '"');
        statusText.textContent = 'Filtering by ' + activeNetworkFilter.type + ': ' + label;
      } else {
        statusEl.classList.remove('active');
      }
    }

    function updateFilterButtonStates() {
      var allBtn = document.querySelector('.pub-filter-btn[data-filter="all"]');
      allBtn.classList.toggle('active', activeFilters.length === 0);
      document.querySelectorAll('.pub-filter-btn:not([data-filter="all"])').forEach(function(b) {
        b.classList.toggle('active', activeFilters.indexOf(b.getAttribute('data-filter')) !== -1);
      });
    }

    document.querySelectorAll('.pub-filter-btn').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var filter = btn.getAttribute('data-filter');
        if (filter === 'all') {
          activeFilters = [];
        } else {
          var idx = activeFilters.indexOf(filter);
          if (idx !== -1) {
            activeFilters.splice(idx, 1);
          } else {
            if (categoryFilters.indexOf(filter) !== -1) {
              activeFilters = activeFilters.filter(function(f) { return categoryFilters.indexOf(f) === -1; });
            }
            activeFilters.push(filter);
          }
        }
        updateFilterButtonStates();
        filterPublications();
      });
    });

    document.getElementById('networkClear').addEventListener('click', function() {
      activeNetworkFilter = null;
      filterPublications();
      if (window._networkDeselectAll) window._networkDeselectAll();
    });

    // ── FETCH & RENDER PUBLICATIONS ──
    fetch('publications/publications.json')
      .then(function(r) { return r.json(); })
      .then(function(data) {
        _pubData = data;
        _authorNameMap = buildAuthorNameMap(data);
        var pubListEl = document.getElementById('pubList');
        pubListEl.innerHTML = data.map(function(p) { return renderPubItem(p); }).join('');
      });

    // ── NETWORK TOGGLE ──
    var networkInitialized = false;
    document.getElementById('networkToggle').addEventListener('click', function() {
      var wrap = document.getElementById('networkWrap');
      var btn = this;
      var isOpen = wrap.classList.toggle('open');
      btn.classList.toggle('open', isOpen);
      var thumb = btn.querySelector('.toggle-thumb').outerHTML;
      btn.innerHTML = isOpen
        ? thumb + '<span class="toggle-arrow">&#9650;</span> Hide Co-authorship Network'
        : thumb + '<span class="toggle-arrow">&#9660;</span> Show Co-authorship Network';
      if (isOpen && !networkInitialized) { networkInitialized = true; setTimeout(initNetwork, 550); }
    });

    // ── D3 COAUTHORSHIP NETWORK ──
    function initNetwork() {
      // Derive network data from fetched publications
      var netPubs = _pubData.map(function(p) {
        var authorNames = p.authors.split(', ').map(function(a) { return _authorNameMap[a.trim()] || a.trim(); });
        var cat = p.category === 'theorem' ? 'Theorem' : (p.category === 'data' ? 'Data' : 'Neither');
        return { title: p.title, year: p.year, category: cat, authors: authorNames };
      });

      var publications = netPubs;
      var CENTER = "Manhart";

      // Auto-derive authorCategory from publications
      var authorCounts = {};
      publications.forEach(function(pub) {
        pub.authors.forEach(function(a) {
          if (!authorCounts[a]) authorCounts[a] = { Data: 0, Theorem: 0, Neither: 0 };
          authorCounts[a][pub.category]++;
        });
      });
      var authorCategory = {};
      Object.keys(authorCounts).forEach(function(a) {
        var c = authorCounts[a];
        if (c.Data >= c.Theorem && c.Data >= c.Neither) authorCategory[a] = 'Data';
        else if (c.Theorem >= c.Data && c.Theorem >= c.Neither) authorCategory[a] = 'Theorem';
        else authorCategory[a] = 'Neither';
      });

      // Build author nodes
      var nodeMap = {};
      publications.forEach(function(pub) {
        pub.authors.forEach(function(a) {
          if (!nodeMap[a]) nodeMap[a] = { id: a, papers: [], count: 0 };
          nodeMap[a].papers.push(pub.title);
          if (a !== CENTER) nodeMap[a].count++;
        });
      });
      var nodes = Object.values(nodeMap);

      // Build pub nodes
      var pubNodes = publications.map(function(pub, i) {
        return { id: '_pub_' + i, isPub: true, pub: pub, title: pub.title, year: pub.year, category: pub.category };
      });

      // Links: author -> pub
      var pubLinks = [];
      publications.forEach(function(pub, i) {
        pub.authors.forEach(function(author) {
          pubLinks.push({ source: author, target: '_pub_' + i });
        });
      });

      // ── PRESET POSITIONS ──
      var PRESET_POSITIONS = {
  "Lancaster": { "x": 149.3, "y": 369.9 },
  "Manhart": { "x": 450, "y": 323.1 },
  "Pichaud": { "x": 162.8, "y": 406.3 },
  "Leech": { "x": 572.8, "y": 575.4 },
  "Dalwadi": { "x": 534.3, "y": 623.2 },
  "Kenny": { "x": 642.3, "y": 590.2 },
  "Marcotti": { "x": 662.5, "y": 575.5 },
  "Shaw": { "x": 681.3, "y": 552.5 },
  "Stramer": { "x": 618.2, "y": 596.9 },
  "Ford": { "x": 85.4, "y": 330 },
  "Chubb": { "x": 102.1, "y": 303.1 },
  "DeFreitas": { "x": 716.5, "y": 610.7 },
  "Drudi": { "x": 753.5, "y": 529.1 },
  "Bell": { "x": 738.4, "y": 569.5 },
  "Easton": { "x": 694.9, "y": 633.1 },
  "Diaz-de-la-Loza": { "x": 780.7, "y": 542.8 },
  "Fleck": { "x": 746.5, "y": 604.8 },
  "Allison": { "x": 776.5, "y": 504.6 },
  "Phillippeos": { "x": 768.6, "y": 574.6 },
  "Degond": { "x": 746.2, "y": 300.6 },
  "Merino-Aceituno": { "x": 776.6, "y": 360.9 },
  "Peurichard": { "x": 783.5, "y": 331.4 },
  "Sala": { "x": 814.9, "y": 397.9 },
  "Karkaria": { "x": 443.5, "y": -56.8 },
  "Rao": { "x": 483.7, "y": -57 },
  "Fedorec": { "x": 457.9, "y": -32 },
  "Barnes": { "x": 512.9, "y": -41 },
  "Hazel": { "x": 482, "y": 676.7 },
  "Gatlin": { "x": 534.6, "y": 680 },
  "Lindsay": { "x": 505.5, "y": 695.2 },
  "Hittmeir": { "x": 749, "y": 64.2 },
  "Kanzler": { "x": 774.1, "y": 98.7 },
  "Schmeiser": { "x": 632.7, "y": 84.3 },
  "Aceves-Sanchez": { "x": 822.5, "y": 254.7 },
  "Keaveny": { "x": 832.6, "y": 291.1 },
  "Azevedo": { "x": 138.9, "y": 223.4 },
  "Baylies": { "x": 208.8, "y": 151.1 },
  "Mogilner": { "x": 258.7, "y": 126.1 },
  "Ierushalmi": { "x": 69.6, "y": 179.3 },
  "Malik-Garbi": { "x": 85.2, "y": 139.5 },
  "Shah": { "x": 77.8, "y": 211.1 },
  "Goode": { "x": 100.5, "y": 166.8 },
  "Keren": { "x": 114.7, "y": 123 },
  "Bhaskar": { "x": 368.5, "y": 702.4 },
  "Milzman": { "x": 377.1, "y": 667.9 },
  "Nardini": { "x": 339.8, "y": 661.5 },
  "Storey": { "x": 416.8, "y": 672.9 },
  "Topaz": { "x": 402.9, "y": 699.1 },
  "Ziegelmeier": { "x": 334.6, "y": 689.8 },
  "Windner": { "x": 234.8, "y": 81.8 },
  "Brown": { "x": 168.6, "y": 83.6 },
  "Icheva": { "x": 282.9, "y": -11.8 },
  "Guerin": { "x": 322.6, "y": -27.3 },
  "Klar": { "x": 283.9, "y": -44.1 },
  "Boujemaa-Paterski": { "x": 320.8, "y": -57.1 },
  "Thery": { "x": 355.9, "y": -47.1 },
  "Blanchoin": { "x": 252.3, "y": -16.2 },
  "Yu": { "x": 740.4, "y": 245.7 },
  "Hartl": { "x": 268.4, "y": 630.8 },
  "Zeller": { "x": 237.5, "y": 612.3 },
  "Selitsch": { "x": 267.6, "y": 591.4 },
  "Lass-Floerl": { "x": 298.4, "y": 613 },
  "Willinger": { "x": 237.2, "y": 573.1 },
  "Oelz": { "x": 597.4, "y": 15.7 },
  "Sfakianakis": { "x": 625.5, "y": 27.9 },
  "Hirsch": { "x": 709.5, "y": 111.1 },
  "Summerer": { "x": 128.1, "y": 533.2 },
  "J. Horst": { "x": 90.9, "y": 473.3 },
  "Erhart": { "x": 151.9, "y": 576.3 },
  "Weissensteiner": { "x": 103.4, "y": 510.1 },
  "Schoenherr": { "x": 70.9, "y": 448.8 },
  "Pacher": { "x": 92.3, "y": 538.6 },
  "Forer": { "x": 72, "y": 500 },
  "D. Horst": { "x": 118.8, "y": 566 },
  "B. Horst": { "x": 124.8, "y": 487.9 },
  "Sanguansermsri": { "x": 98.9, "y": 438.2 },
  "Kloss-Brandstaetter": { "x": 156.6, "y": 543.9 },
  "_pub_0": { "x": 311.8, "y": 374.8 },
  "_pub_1": { "x": 503.7, "y": 464.9 },
  "_pub_2": { "x": 563.9, "y": 481.2 },
  "_pub_3": { "x": 270.3, "y": 329.8 },
  "_pub_4": { "x": 623.9, "y": 480.9 },
  "_pub_5": { "x": 651.2, "y": 365 },
  "_pub_6": { "x": 457.1, "y": 115.1 },
  "_pub_7": { "x": 480.8, "y": 520.4 },
  "_pub_8": { "x": 626.7, "y": 186.1 },
  "_pub_9": { "x": 664.4, "y": 306.5 },
  "_pub_10": { "x": 290.3, "y": 258.8 },
  "_pub_11": { "x": 238.7, "y": 228.2 },
  "_pub_12": { "x": 402.9, "y": 528 },
  "_pub_13": { "x": 291, "y": 198.8 },
  "_pub_14": { "x": 361.5, "y": 109.7 },
  "_pub_15": { "x": 519.3, "y": 382.8 },
  "_pub_16": { "x": 620.2, "y": 265.8 },
  "_pub_17": { "x": 341.4, "y": 166.2 },
  "_pub_18": { "x": 392.3, "y": 197.8 },
  "_pub_19": { "x": 607.1, "y": 324.4 },
  "_pub_20": { "x": 574.7, "y": 156.1 },
  "_pub_21": { "x": 345.5, "y": 235.3 },
  "_pub_22": { "x": 522.2, "y": 187.1 },
  "_pub_23": { "x": 574.7, "y": 216.1 },
  "_pub_24": { "x": 523.7, "y": 124.6 },
  "_pub_25": { "x": 244.9, "y": 441.6 },
  "_pub_26": { "x": 345.4, "y": 477 }
};

      var allNodes = nodes.concat(pubNodes);
      var svg = d3.select('#network-graph');
      var tooltip = document.getElementById('network-tooltip');
      var W = svg.node().clientWidth;
      var H = svg.node().clientHeight;
      var g = svg.append('g');

      svg.call(d3.zoom().scaleExtent([0.3, 3]).on('zoom', function(e) { g.attr('transform', e.transform); }));

      var rScale = d3.scaleSqrt().domain([1, 27]).range([5, 20]);
      nodes.forEach(function(n) {
        if (n.id === CENTER) { n._r = 16; }
        else { n._r = rScale(n.papers.length); }
      });

      var simulation = d3.forceSimulation(allNodes)
        .force('link', d3.forceLink(pubLinks).id(function(d) { return d.id; }).distance(80).strength(0.5))
        .force('charge', d3.forceManyBody().strength(function(d) { return d.isPub ? -300 : -120; }))
        .force('center', d3.forceCenter(W / 2, H / 2))
        .force('collision', d3.forceCollide(function(d) { return d.isPub ? 30 : (d._r || 8) + 6; }));

      var link = g.append('g').selectAll('line').data(pubLinks).join('line')
        .attr('class', 'net-link').attr('stroke-width', 1);

      var node = g.append('g').selectAll('g').data(allNodes).join('g').attr('class', 'net-node')
        .call(d3.drag()
          .on('start', function(e, d) { if (!e.active && !hasPreset) simulation.alphaTarget(0.3).restart(); d.fx = d.x; d.fy = d.y; })
          .on('drag', function(e, d) { d.fx = e.x; d.fy = e.y; if (hasPreset) { d.x = e.x; d.y = e.y; simulation.tick(); } })
          .on('end', function(e, d) { if (!hasPreset) { if (!e.active) simulation.alphaTarget(0); d.fx = null; d.fy = null; } })
        );

      // Author circles
      node.filter(function(d) { return !d.isPub; }).append('circle')
        .attr('r', function(d) { return d._r || 8; })
        .attr('fill', function(d) {
          if (d.id === CENTER) return '#e05c2a';
          var cat = authorCategory[d.id] || 'Data';
          return cat === 'Theorem' ? '#c0392b' : '#059669';
        })
        .attr('stroke', function(d) { return d.id === CENTER ? '#c04010' : '#fff'; })
        .attr('stroke-width', function(d) { return d.id === CENTER ? 3 : 1.5; });

      // Publication squares
      node.filter(function(d) { return d.isPub; }).append('rect')
        .attr('width', 20).attr('height', 20).attr('x', -10).attr('y', -10)
        .attr('fill', function(d) { return d.category === 'Theorem' ? '#fca5a5' : '#a7f3d0'; })
        .attr('stroke', function(d) { return d.category === 'Theorem' ? '#c0392b' : '#059669'; })
        .attr('stroke-width', 2).attr('rx', 3);

      // Author labels
      node.filter(function(d) { return !d.isPub; }).append('text')
        .attr('dy', function(d) { return (d._r || 8) + 11; })
        .attr('text-anchor', 'middle')
        .text(function(d) { return d.id; })
        .style('font-weight', function(d) { return d.id === CENTER ? '700' : '400'; })
        .style('font-size', function(d) { return d.id === CENTER ? '13px' : '11px'; });

      // Hover behavior
      node.on('mouseover', function(event, d) {
        if (d.isPub) {
          var authorIds = pubLinks.filter(function(l) {
            return (typeof l.target === 'object' ? l.target.id : l.target) === d.id;
          }).map(function(l) { return typeof l.source === 'object' ? l.source.id : l.source; });
          node.classed('dimmed', function(n) { return !n.isPub && authorIds.indexOf(n.id) === -1; });
          link.classed('dimmed', function(l) { return (typeof l.target === 'object' ? l.target.id : l.target) !== d.id; });
          link.classed('highlighted', function(l) { return (typeof l.target === 'object' ? l.target.id : l.target) === d.id; });
          tooltip.innerHTML = '<div class="tt-name">' + d.title + '</div><div class="tt-count">' + d.year + ' &middot; ' + (d.category === 'Theorem' ? 'Proofs' : d.category) + '</div>';
        } else {
          var connPubIds = pubLinks.filter(function(l) {
            return (typeof l.source === 'object' ? l.source.id : l.source) === d.id;
          }).map(function(l) { return typeof l.target === 'object' ? l.target.id : l.target; });
          node.classed('dimmed', function(n) {
            if (n.id === d.id) return false;
            if (n.isPub) return connPubIds.indexOf(n.id) === -1;
            var theirPubs = pubLinks.filter(function(l) {
              return (typeof l.source === 'object' ? l.source.id : l.source) === n.id;
            }).map(function(l) { return typeof l.target === 'object' ? l.target.id : l.target; });
            return !connPubIds.some(function(p) { return theirPubs.indexOf(p) !== -1; });
          });
          link.classed('dimmed', function(l) { return (typeof l.source === 'object' ? l.source.id : l.source) !== d.id; });
          link.classed('highlighted', function(l) { return (typeof l.source === 'object' ? l.source.id : l.source) === d.id; });
          tooltip.innerHTML = '<div class="tt-name">' + d.id + '</div><div class="tt-count">' + d.papers.length + ' publication' + (d.papers.length > 1 ? 's' : '') + '</div>';
        }
        tooltip.style.opacity = 1;
      })
      .on('mousemove', function(event) {
        tooltip.style.left = (event.clientX + 14) + 'px';
        tooltip.style.top = (event.clientY - 10) + 'px';
      })
      .on('mouseleave', function() {
        node.classed('dimmed', false);
        link.classed('dimmed', false).classed('highlighted', false);
        tooltip.style.opacity = 0;
      });

      // Click to filter publications
      var selectedNode = null;
      node.on('click', function(event, d) {
        event.stopPropagation();
        if (selectedNode === d) {
          // Deselect
          selectedNode = null;
          activeNetworkFilter = null;
          node.classed('selected', false);
        } else {
          selectedNode = d;
          node.classed('selected', function(n) { return n === d; });
          if (d.isPub) {
            activeNetworkFilter = { type: 'pub', value: d.title };
          } else {
            activeNetworkFilter = { type: 'author', value: d.id };
          }
          // Clear tag filters when selecting from network
          activeFilters = [];
          updateFilterButtonStates();
        }
        filterPublications();
      });

      // Allow deselect by clicking on background
      svg.on('click', function() {
        if (selectedNode) {
          selectedNode = null;
          activeNetworkFilter = null;
          node.classed('selected', false);
          filterPublications();
        }
      });

      // Expose deselect for the Clear button
      window._networkDeselectAll = function() {
        selectedNode = null;
        node.classed('selected', false);
      };

      simulation.on('tick', function() {
        link.attr('x1', function(d) { return d.source.x; }).attr('y1', function(d) { return d.source.y; })
            .attr('x2', function(d) { return d.target.x; }).attr('y2', function(d) { return d.target.y; });
        node.attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });
      });

      // Apply preset positions or pre-settle with force layout
      var hasPreset = Object.keys(PRESET_POSITIONS).length > 0;
      var hasNewNodes = false;
      g.style('opacity', 0);
      function updatePositions() {
        link.attr('x1', function(d) { return d.source.x; }).attr('y1', function(d) { return d.source.y; })
            .attr('x2', function(d) { return d.target.x; }).attr('y2', function(d) { return d.target.y; });
        node.attr('transform', function(d) { return 'translate(' + d.x + ',' + d.y + ')'; });
      }

      if (hasPreset) {
        allNodes.forEach(function(n) {
          var pos = PRESET_POSITIONS[n.id];
          if (pos) { n.x = pos.x; n.y = pos.y; n.fx = pos.x; n.fy = pos.y; }
          else { hasNewNodes = true; }
        });
        if (hasNewNodes) {
          for (var i = 0; i < 300; i++) simulation.tick();
        }
        simulation.alpha(0).stop();
        updatePositions();
      } else {
        for (var i = 0; i < 300; i++) simulation.tick();
        simulation.alpha(0.3).restart();
      }
      g.transition().duration(600).style('opacity', 1);

      // ── EXPORT LAYOUT BUTTON ──
      var exportBtn = document.createElement('button');
      exportBtn.textContent = 'Export Layout';
      exportBtn.style.cssText = 'position:absolute;bottom:8px;right:8px;padding:0.4rem 0.9rem;background:var(--accent2);color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:0.75rem;font-weight:600;letter-spacing:0.04em;text-transform:uppercase;opacity:0.7;z-index:10;';
      exportBtn.title = 'Copy current node positions as JSON to clipboard (also logged to console)';
      var netInner = document.querySelector('.pub-network-inner');
      if (netInner) { netInner.style.position = 'relative'; netInner.appendChild(exportBtn); }
      exportBtn.addEventListener('click', function() {
        var positions = {};
        allNodes.forEach(function(n) { positions[n.id] = { x: Math.round(n.x * 10) / 10, y: Math.round(n.y * 10) / 10 }; });
        var json = JSON.stringify(positions, null, 2);
        console.log('// Paste this into PRESET_POSITIONS:\n' + json);
        if (navigator.clipboard) {
          navigator.clipboard.writeText(json).then(function() { exportBtn.textContent = 'Copied!'; setTimeout(function() { exportBtn.textContent = 'Export Layout'; }, 2000); });
        } else {
          exportBtn.textContent = 'See console'; setTimeout(function() { exportBtn.textContent = 'Export Layout'; }, 2000);
        }
      });
    }

    // ── SCROLL REVEAL ──
    var reveals = document.querySelectorAll('.reveal');
    if (reveals.length && 'IntersectionObserver' in window) {
      var obs = new IntersectionObserver(function(entries) {
        entries.forEach(function(e) {
          if (e.isIntersecting) { e.target.style.opacity = '1'; e.target.style.transform = 'none'; obs.unobserve(e.target); }
        });
      }, { threshold: 0.1 });
      reveals.forEach(function(el) { el.style.opacity = '0'; el.style.transform = 'translateY(20px)'; el.style.transition = 'opacity 0.6s ease, transform 0.6s ease'; obs.observe(el); });
    }
  </script>
</body>
</html>
